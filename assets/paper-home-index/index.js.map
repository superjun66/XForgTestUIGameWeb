{"version":3,"sources":["../file:/D:/XForgTestUIGame/assets/app-bundle/app-view/paper/home/index/native/file:/D:/XForgTestUIGame/assets/app-bundle/app-view/paper/home/index/native/PaperHomeIndex.ts"],"names":["ccclass","_decorator","property","PaperHomeIndex","_dec","_dec2","Node","_dec3","_dec4","_dec5","_dec6","Label","_class","_class2","_BaseView$BindControl","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_descriptor","_assertThisInitialized","_descriptor2","_descriptor3","_descriptor4","_descriptor5","maxCount","_proto","prototype","onLoad","_this2","pop","on","Button","EventType","CLICK","app","manager","ui","show","name","data","viewName","_loop","node","instantiate","identity","i","active","button","getComponent","clickEvents","customEventData","toString","log","config","AllotIdentityCfg","icon","loader","load","bundle","path","type","SpriteFrame","onComplete","asset","console","Sprite","spriteFrame","layout","addChild","controller","HomeController","Event","IDENTITY_COUNT_UPDATE","updateCount","onShow","params","_this3","scheduleOnce","home","refresh","emit","Refresh2","test","onHide","targetOff","onClickIdentity","event","target","countNode","find","count","string","cutCount","num","JmRoomDataMgr","delRoomCfg","Number","setRoomCfg","getRoomCfg","countBg","onClickClose","onCreateRoom","title","message","okCb","okText","dialogType","cfg","identities","get","push","setRoomCount","setOwner","setGameState","BaseView","BindController","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","_RF"],"mappings":"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","file":"all.js","sourcesContent":["import { _decorator, Button, find, instantiate, Label, Layout, Node, Prefab, Sprite, SpriteFrame } from 'cc';\r\nimport BaseView from '../../../../../../../extensions/app/assets/base/BaseView';\r\nimport { HomeController } from '../../../../../../app-builtin/app-controller/HomeController';\r\nimport { app } from '../../../../../../app/app';\r\nimport JmRoomDataMgr from 'db://assets/res-native/manager/JmRoomDataMgr';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PaperHomeIndex')\r\nexport class PaperHomeIndex extends BaseView.BindController(HomeController) {\r\n    @property(Node)\r\n    goto: Node;\r\n    @property(Node)\r\n    pop: Node;\r\n\r\n    @property(Node)\r\n    layout: Node;\r\n    @property(Node)\r\n    identity: Node;\r\n    @property(Label)\r\n    num: Label = null;\r\n\r\n  maxCount = 0\r\n    // 初始化的相关逻辑写在这\r\n    onLoad() {\r\n        // this.goto.on(Button.EventType.CLICK, () => {\r\n        //     app.manager.ui.show({\r\n        //         name: 'PageGame'\r\n        //     });\r\n        // });\r\n        this.pop.on(Button.EventType.CLICK, () => {\r\n            app.manager.ui.show({\r\n                name: 'PopTip',\r\n                data: this.viewName\r\n            });\r\n        });\r\n\r\n        for (let i = 1; i < 17; i++) {\r\n            let node = instantiate(this.identity);\r\n            node.name = `identity${i}`;\r\n            node.active = true;\r\n            let button = node.getComponent(Button);\r\n            if (button) {\r\n                // 通过按钮的 clickEvents 来设置自定义数据\r\n                if (button.clickEvents && button.clickEvents.length > 0) {\r\n                    // 如果已经有click事件，修改第一个事件的customEventData\r\n                    button.clickEvents[0].customEventData = i.toString();\r\n                } else {\r\n                    // 如果没有click事件，可能需要添加新的事件\r\n                    // 这种情况通常在编辑器中设置，代码中较少动态添加\r\n                }\r\n            }\r\n            this.log('app.config.const.AllotIdentityCfg[i].icon=', app.config.const.AllotIdentityCfg[i].icon)\r\n            app.manager.loader.load({\r\n                bundle: 'identity', // 不传入bundle，默认为resources\r\n                path: `${app.config.const.AllotIdentityCfg[i].icon}_n/spriteFrame`,\r\n                type: SpriteFrame,\r\n                onComplete(asset) {\r\n                    console.log('加载资源完成', asset);\r\n                    node.getComponent(Sprite).spriteFrame = asset;\r\n                }\r\n            })\r\n\r\n            this.layout.addChild(node);\r\n        }\r\n        //监听\r\n        this.controller.on(HomeController.Event.IDENTITY_COUNT_UPDATE, this.updateCount, this);\r\n    }\r\n\r\n    // 界面打开时的相关逻辑写在这(onShow可被多次调用-它与onHide不成对)\r\n    onShow(params: any) {\r\n        // 这里延迟一下，等PageHome初始化完成再触发事件\r\n        this.scheduleOnce(() => {\r\n            // 通过单例只能访问对外暴露的接口\r\n            app.controller.home.refresh('PaperHomeIndex');\r\n\r\n            // 通过绑定的controller实例访问内部事件\r\n            this.controller.emit(HomeController.Event.Refresh2, 'PaperHomeIndex');\r\n\r\n            // 报错，外部不可写\r\n            // app.controller.home.test = 1;\r\n\r\n            // 正确，内部可写\r\n            this.controller.test = 10;\r\n        });\r\n    }\r\n\r\n    onHide(data?: any) {\r\n        this.controller.targetOff(this);\r\n    }\r\n\r\n    onClickIdentity(event: Event, target: string) {\r\n        this.log('event=', event);\r\n        this.log('target=', target);\r\n\r\n        // this.layout.addChild(app.manager.ui.createNode({\r\n        //     name: 'Identity',\r\n\r\n        // app.manager.ui.show<UI类>({\r\n        //     name: '自动提示UI名',\r\n        //     data: 自动提示onShow方法需要的参数,\r\n        //     onShow: () => {\r\n\r\n        //     },\r\n        //     onHide: (result) => { \r\n        //     //result自动识别为onHide的返回值类型 \r\n        //     },\r\n        //     onError: () => {\r\n\r\n        //     }\r\n        // });\r\n\r\n        let countNode = find(`identity${target}/numBg/num`, this.layout)\r\n        let count = countNode.getComponent(Label).string\r\n        let data = {\r\n            type: target,\r\n            count: count,\r\n            maxCount: this.maxCount\r\n        }\r\n        app.manager.ui.show({\r\n            data: data,\r\n            name: 'PopIdentity'\r\n        });\r\n    }\r\n\r\n    updateCount(data:any) {\r\n        this.maxCount += data.cutCount\r\n        this.num.string = `总人数：${this.maxCount}人`;\r\n\r\n        if (data.count <= 0)\r\n        JmRoomDataMgr.delRoomCfg(Number(data.type))\r\n        else\r\n        JmRoomDataMgr.setRoomCfg(Number(data.type), data.count)\r\n\r\n        this.log('JmRoomDataMgr.getRoomCfg()=', JmRoomDataMgr.getRoomCfg());\r\n        let countBg = find(`identity${data.type}/numBg`, this.layout)\r\n        countBg.active = data.count > 0\r\n        let countNode = find(`identity${data.type}/numBg/num`, this.layout)\r\n        countNode.getComponent(Label).string = data.count\r\n    }\r\n\r\n    onClickClose() {\r\n        app.manager.ui.show({\r\n            name: 'PageMain'\r\n        });\r\n    }\r\n\r\n    onCreateRoom() {\r\n        if (this.maxCount < 6) {\r\n            app.manager.ui.show({\r\n                data : {\r\n                        title: \"提示\",\r\n                        message: \"开局人数最少为6人哦~\",\r\n                        okCb: () => { },\r\n                        okText: \"知道了\",\r\n                        dialogType: 2\r\n                    },\r\n                name: 'PopCommondialog',\r\n            });\r\n            return\r\n        }\r\n        \r\n\r\n        let cfg = JmRoomDataMgr.getRoomCfg()\r\n        let identities = []\r\n        for (let i = 1; i < 17; i++) {\r\n        if (cfg.get(i))\r\n            identities.push(cfg.get(i))\r\n        else\r\n            identities.push(0)\r\n        }\r\n        // JmRoomDataMgr.InitCurrentRoomProto();\r\n        JmRoomDataMgr.setRoomCount(this.maxCount)\r\n        JmRoomDataMgr.setOwner(true)\r\n        JmRoomDataMgr.setGameState(2)\r\n\r\n        app.manager.ui.show({\r\n            name: 'PageRoom',\r\n        });\r\n    }\r\n}"]}