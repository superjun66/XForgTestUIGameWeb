{"version":3,"sources":["../file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/JmIdentityCell.ts","../file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/JmIdentityItem.ts","../file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/file:/D:/XForgTestUIGameUp/assets/app-bundle/app-view/paper/room/room/native/PaperRoomRoom.ts"],"names":["ccclass","_decorator","property","_dec","Layout","_descriptor","_applyDecoratedDescriptor","_class2","_JmListViewItem","JmIdentityCell","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_assertThisInitialized","children","_inheritsLoose","_proto","prototype","updateItem","id","data","listView","i","ins","this","JmNodePoolMgr","GetCell","IdentityCellPool","parent","container","node","getComponent","JmIdentityItem","init","removeFromParent","destroy","onDisable","onDestroy","child","len","isValid","active","JmListViewItem","configurable","enumerable","writable","initializer","_class","_RF","pop","Node","_dec2","_dec3","_dec4","Label","_dec5","_dec6","_dec7","_JmClickComponent","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","_descriptor7","onLoad","start","onEnable","console","log","nickName","string","userId","app","Manager","Util","strClamp","url","self","manager","loader","load","bundle","path","type","SpriteFrame","onComplete","asset","seat","Sprite","spriteFrame","updateDay","JmRoomDataMgr","getGameDay","isOwner","updateIdentity","headerThumb","icon","loadRemote","ext","sp","texture","Texture2D","image","isDay","dayNode","nightNode","color","Color","fromHEX","pic","out","identity","AllotIdentityCfg","config","onItemClick","target","onClickItem","getGameState","JmClickComponent","JmListView","Prefab","_dec8","RichText","_dec9","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_BaseView$BindControl","PaperRoomRoom","_descriptor8","_descriptor9","_descriptor10","_descriptor11","_descriptor12","_descriptor13","_descriptor14","identityType","gameRoomSeatsInfoData","_roomKey","gameState","txt","cardNode","allotIdentityCfg","testType","initData","controller","on","RoomController","Event","UPDATE_GAME_IDENTITY","onShow","params","onHide","result","targetOff","onClickBack","ui","show","name","_this2","rsp","recordId","roomNum","status","players","curPlayers","judge","seats","identities","InitCurrentRoom","IsIpad","find","setScale","Widget","top","updateAlignment","updateUI","InitNodePool","identityItem","getRoomCfg","cfg","sortedArray","from","entries","sort","a","b","Number","forEach","_ref","index","k","v","cfgText","UITransform","height","txtBg","GetRoomSeats","getRoomCount","push","setComponentName","setData","sliceData","scheduleOnce","notifyChange","tagNode","bottomMargin","setPosition","getContentHeight","ScrollView","elastic","GetCurrentRoomKey","updateBtn","identityTxt","identityIcon","_this3","IsIphoneX","identityLabel","identityNode","bottom","getChildByName","restoreData","slicedData","slice","onClickStart","room","updateGameIdentity","getData","onClickTestRes","onClickTestRes1","updateRoomSeats","day","BaseView","BindController"],"mappings":"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","file":"all.js","sourcesContent":["import { _decorator, isValid, Layout, Node } from \"cc\";\r\nimport JmListView from \"db://assets/res-native/tool/JmListView\";\r\nimport JmListViewItem from \"db://assets/res-native/tool/JmListViewItem\";\r\nimport JmNodePoolMgr from \"db://assets/res-native/tool/JmNodePoolMgr\";\r\nimport JmIdentityItem from \"./JmIdentityItem\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass\r\nexport default class JmIdentityCell extends JmListViewItem {\r\n    @property(Layout)\r\n    container: Layout = null\r\n\r\n    private children = new Array<Node>();\r\n\r\n    updateItem(id: number, data: any, listView: JmListView) {\r\n        super.updateItem(id, data, listView);\r\n        for (let i = 0; i < 4; i++) {\r\n            if (!data[i]) {\r\n                let ins = this.children[i]\r\n                if (ins) {\r\n                    ins.removeFromParent()\r\n                    ins.destroy()\r\n                    this.children[i] = null\r\n                }\r\n            } else {\r\n                let ins = this.children[i]\r\n                if (!ins) {\r\n                    ins = JmNodePoolMgr.GetCell(JmNodePoolMgr.IdentityCellPool);\r\n                    ins.parent = this.container.node\r\n                    this.children[i] = ins\r\n                }\r\n                let roomCell = ins.getComponent(JmIdentityItem);\r\n                roomCell.init(data[i], (id * 4) + i + 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    protected onDestroy() {\r\n        // super.onDestroy();\r\n        let child, children = this.children;\r\n        for (let i = 0, len = children.length; i < len; i++) {\r\n            child = children[i];\r\n            if (isValid(child, true)) {\r\n                child.active = false;\r\n                child.destroy();\r\n            }\r\n        }\r\n        this.children = [];\r\n    }\r\n}\r\n","// import { AllotIdentityCfg } from \"../../config/JmConst\";\r\n// import { JmClickComponent } from \"../../extension/JmClickComponent\";\r\n// import JmResourceMgr from \"../../jmManager/JmResourceMgr\";\r\n// import JmRoomDataMgr from \"../../jmManager/JmRoomDataMgr\";\r\n// import JmUserDataMgr from \"../../jmManager/JmUserDataMgr\";\r\n// import JmHttpSender from \"../../network/netManager/JmHttpSender\";\r\n// import { JmPlatformUtils } from \"../../platformUtil/JmPlatformUtils\";\r\n// import Log from \"../../util/Log\";\r\n// import Util from \"../../util/Util\";\r\n\r\nimport { _decorator, Asset, Color, ImageAsset, Label, Node, Sprite, SpriteFrame, Texture2D } from \"cc\";\r\nimport { app } from \"db://assets/app/app\";\r\nimport JmRoomDataMgr from \"db://assets/res-native/manager/JmRoomDataMgr\";\r\nimport { JmClickComponent } from \"db://assets/res-native/tool/JmClickComponent\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n// const qq = window['qq'];\r\n\r\n@ccclass\r\nexport default class JmIdentityItem extends JmClickComponent {\r\n  @property(Node)\r\n  seat: Node = null;\r\n  @property(Node)\r\n  icon: Node = null;\r\n  @property(Node)\r\n  pic: Node = null;\r\n  @property(Label)\r\n  nickName: Label = null;\r\n  @property(Node)\r\n  dayNode: Node = null;\r\n  @property(Node)\r\n  nightNode: Node = null;\r\n  @property(Node)\r\n  out: Node = null;\r\n\r\n  data:any = null\r\n  id = 0\r\n  onLoad() {\r\n  }\r\n\r\n  start() {\r\n  }\r\n\r\n  onEnable() {\r\n    super.onEnable()\r\n  }\r\n\r\n  onDisable() {\r\n    super.onEnable()\r\n  }\r\n\r\n  onDestroy() {\r\n  }\r\n\r\n  init(data:any, id:number) {\r\n    console.log('JmIdentityItem');\r\n    this.id = id\r\n    this.data = data\r\n    this.nickName.string = data.userId ? app.Manager.Util.strClamp(data.nickName, 5, \"...\") : '点击邀请'\r\n\r\n    let url = `pic_seat_${id}/spriteFrame`\r\n    // if (data.userId == JmUserDataMgr.GetCurrentUserId()) {\r\n    //   url = `identityBig/pic_myseat_${id}/spriteFrame`\r\n    // }\r\n    let self = this\r\n    app.manager.loader.load({\r\n        bundle: 'identitybig', // 不传入bundle，默认为resources\r\n        path: url,\r\n        type: SpriteFrame,\r\n        onComplete(asset) {\r\n            self.seat.getComponent(Sprite).spriteFrame = asset;\r\n        }\r\n    })\r\n    this.updateDay(JmRoomDataMgr.getGameDay())\r\n    if (JmRoomDataMgr.isOwner() && !JmRoomDataMgr.getGameDay()) {\r\n      this.updateIdentity()\r\n    }\r\n    if (data.headerThumb) {\r\n      let self = this\r\n      self.icon.active = true\r\n      let headerThumb = data.headerThumb\r\n      app.manager.loader.loadRemote({\r\n        url: headerThumb,\r\n        ext: '.png', // 指定图片扩展名\r\n        onComplete(data: any) {\r\n          let sp: SpriteFrame = new SpriteFrame();\r\n          let texture = new Texture2D();\r\n          texture.image = data;\r\n          sp.texture = texture;\r\n          self.icon.getComponent(Sprite).spriteFrame = sp;\r\n        }\r\n      })\r\n    }\r\n    else {\r\n      this.icon.active = false\r\n    }\r\n\r\n    // this.out.active = data.status == 2\r\n  }\r\n\r\n  updateDay(isDay: boolean) {\r\n    this.dayNode.active = isDay;\r\n    this.nightNode.active = !isDay;\r\n    if (isDay) {\r\n      this.nickName.color = new Color().fromHEX(\"#E7F0FD\");\r\n      this.pic.getComponent(Sprite).spriteFrame = null;\r\n      this.pic.active = false;\r\n      this.out.active = false\r\n    } else {\r\n      this.nickName.color = new Color().fromHEX(\"#C0C4D8\");\r\n    }\r\n  }\r\n\r\n  updateIdentity() {\r\n    console.log('updateIdentity=', this.data.identity);\r\n    let AllotIdentityCfg = app.config.const.AllotIdentityCfg;\r\n    if (AllotIdentityCfg[this.data.identity]) {\r\n      let picUrl = AllotIdentityCfg[this.data.identity].pic;\r\n      let self = this\r\n      // let bundle = assetManager.getBundle('assetsRes');\r\n      // bundle.load(picUrl, SpriteFrame, function (err, spFrame: SpriteFrame) {\r\n      //   if (err) {\r\n      //     log(err.message || err);\r\n      //     return;\r\n      //   }\r\n      //   self.pic.getComponent(Sprite).spriteFrame = spFrame;\r\n      //   self.pic.active = true;\r\n      // });\r\n    }\r\n    else {\r\n      this.pic.active = false;\r\n      this.pic.getComponent(Sprite).spriteFrame = null;\r\n    }\r\n  }\r\n\r\n  protected onItemClick(target:any) {\r\n    this.onClickItem(target)\r\n  }\r\n\r\n  onClickItem(target: any) {\r\n    console.log('邀请 id=', this.id);\r\n    if (JmRoomDataMgr.getGameState() == 0 && JmRoomDataMgr.isOwner() && this.data.identity != 0) {\r\n      this.out.active = !this.out.active\r\n    }\r\n  }\r\n}\r\n","import { _decorator, Asset, Color, find, ImageAsset, Label, Layout, Node, Prefab, RichText, ScrollView, Sprite, SpriteFrame, Texture2D, UITransform, v2, Widget } from 'cc';\r\nimport BaseView from '../../../../../../../extensions/app/assets/base/BaseView';\r\nimport { app } from 'db://assets/app/app';\r\nimport JmListView from 'db://assets/res-native/tool/JmListView';\r\nimport JmNodePoolMgr from 'db://assets/res-native/tool/JmNodePoolMgr';\r\nimport JmRoomDataMgr from 'db://assets/res-native/manager/JmRoomDataMgr';\r\nimport { RoomController } from 'db://assets/app-builtin/app-controller/RoomController';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PaperRoomRoom')\r\nexport class PaperRoomRoom extends BaseView.BindController(RoomController) {\r\n  @property(JmListView)\r\n  listView: JmListView = null\r\n  @property(Prefab)\r\n  identityItem: Prefab = null\r\n  @property(Node)\r\n  bg: Node = null;\r\n  @property(Node)\r\n  godNode: Node = null;\r\n  @property(Node)\r\n  tagNode: Node = null;\r\n  @property(Label)\r\n  roomNum: Label = null;\r\n  @property(RichText)\r\n  cfgText: RichText = null;\r\n  @property(Node)\r\n  txtBg: Node = null;\r\n  @property(Layout)\r\n  identityNode: Layout = null;\r\n  @property(Label)\r\n  identityTxt: Label = null;\r\n  @property(Node)\r\n  identityIcon: Node = null;\r\n  @property(Node)\r\n  layoutBg: Node = null;\r\n  @property(Node)\r\n  identityBg: Node = null;\r\n  @property(Label)\r\n  identityLabel: Label = null;\r\n\r\n  identityType = 0\r\n  gameRoomSeatsInfoData: any = null;\r\n  _roomKey: any = null;\r\n  gameState = 0\r\n  txt = ''\r\n  cardNode: any = null\r\n  allotIdentityCfg: any = null\r\n\r\n  // 初始化的相关逻辑写在这\r\n  onLoad() {\r\n    this.init()\r\n    this.initData()\r\n    //监听\r\n    this.controller.on(RoomController.Event.UPDATE_GAME_IDENTITY, this.updateIdentity, this);\r\n  }\r\n\r\n  // 界面打开时的相关逻辑写在这(onShow可被多次调用-它与onHide不成对)\r\n  onShow(params: any) {\r\n\r\n  }\r\n\r\n  // 界面关闭时的相关逻辑写在这(已经关闭的界面不会触发onHide)\r\n  onHide(result: undefined) {\r\n    this.controller.targetOff(this);\r\n  }\r\n\r\n  onClickBack() {\r\n    app.manager.ui.show({\r\n      name: 'PageHome',\r\n    });\r\n  }\r\n\r\n  init() {\r\n    let rsp1 =\r\n    {\r\n      \"recordId\": 49, \"roomNum\": 1036, \"status\": 0, \"players\": 24, \"curPlayers\": 2, \"judge\": true,\r\n      \"seats\": [\r\n        { \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 },\r\n        { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 }\r\n      ],\r\n      \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\"\r\n    }\r\n    let rsp2 =\r\n    {\r\n      \"recordId\": 49, \"roomNum\": 1036, \"status\": 0, \"players\": 24, \"curPlayers\": 2, \"judge\": false,\r\n      \"seats\": [\r\n        { \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 },\r\n        { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 },\r\n        { \"status\": 0, \"identity\": 0 }\r\n      ],\r\n      \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\"\r\n    }\r\n\r\n    let rsp = true ? rsp1 : rsp2\r\n    JmRoomDataMgr.InitCurrentRoom(rsp);\r\n\r\n    if (app.Manager.Util.IsIpad()) {\r\n      find('top', this.node).setScale(0.5, 0.5, 0.5)\r\n      find('centre', this.node).setScale(0.7, 0.7)\r\n      find('bottom', this.node).setScale(0.7, 0.7)\r\n      find('top/back', this.node).getComponent(Widget).top = 10\r\n      find('top/back', this.node).getComponent(Widget).updateAlignment();\r\n    }\r\n    this.roomNum.string = '1001'//JmRoomDataMgr.GetRoomNum();\r\n    this.gameRoomSeatsInfoData = null\r\n\r\n    let self = this\r\n    // JmHttpSender.RequestAdvertisingConfig().then((result: any) => {\r\n    //   this.log(`RequestGameStart Success ${JSON.stringify(result)}`);\r\n    //   //显示广告\r\n    //   self.advertisementNode.active = result.display\r\n    //   self.identityNode.getComponent(Widget).top = self.advertisementNode.active ? 360 : 180\r\n    self.updateUI()\r\n    // }, (err) => {\r\n    //   this.log(`RequestGameStart Failed! ${err}`);\r\n    // });\r\n    JmNodePoolMgr.InitNodePool(JmNodePoolMgr.IdentityCellPool, this.identityItem, \"JmIdentityItem\");\r\n    this.log('JmRoomDataMgr.getRoomCfg()=', JmRoomDataMgr.getRoomCfg());\r\n    let cfg = JmRoomDataMgr.getRoomCfg()\r\n    let txt = ''\r\n    this.allotIdentityCfg = app.config.const.AllotIdentityCfg\r\n    const sortedArray = Array.from(cfg.entries()).sort((a, b) => Number(a[0]) - Number(b[0]));\r\n    sortedArray.forEach(([k, v], index) => {\r\n      this.log('k=', k);\r\n      this.log('v=', v);\r\n      txt += this.allotIdentityCfg[k].name + 'x' + v;\r\n      if (index < sortedArray.length - 1) {\r\n        txt += '，';\r\n      }\r\n    });\r\n    this.txt = txt\r\n    this.cfgText.string = `<color=#848EA3>【本局配置】</c><color=#4A5979>${txt}</color>`\r\n    this.log('this.cfgText.node.getContentSize().height=', this.cfgText.node.getComponent(UITransform).height);\r\n    if (this.cfgText.node.getComponent(UITransform).height < 120)\r\n      this.txtBg.getComponent(UITransform).height = 200\r\n    else\r\n      this.txtBg.getComponent(UITransform).height = this.cfgText.node.getComponent(UITransform).height + 79\r\n\r\n    let data = []\r\n    if (JmRoomDataMgr.GetRoomSeats())\r\n      data = JmRoomDataMgr.GetRoomSeats();\r\n    else {\r\n      for (let i = 0; i < JmRoomDataMgr.getRoomCount(); i++) {\r\n        data.push({\r\n          userId: null,\r\n          name: '',\r\n          icon: '',\r\n          identity: 0,\r\n          headerThumb: '',\r\n        },)\r\n      }\r\n    }\r\n    // for (let i = 0; i < JmRoomDataMgr.getRoomCount(); i++) {\r\n    //   data.push({\r\n    //     userId: null,\r\n    //     name: '点击邀请',//'邬菲' + i,\r\n    //     icon: '',\r\n    //     identity: 0,\r\n    //     headerThumb: '',\r\n    //   },)\r\n    // }\r\n    this.listView.setComponentName('JmIdentityCell');\r\n    this.listView.setData(this.sliceData(data));\r\n    this.scheduleOnce(() => {\r\n      this.listView.notifyChange()\r\n      this.tagNode.active = JmRoomDataMgr.isOwner()\r\n      this.listView.bottomMargin = JmRoomDataMgr.isOwner() ? 80 : 0\r\n      this.tagNode.setPosition(0, -this.listView.getContentHeight() + 30)\r\n      let height = JmRoomDataMgr.isOwner() ? this.listView.getContentHeight() + 50 : this.listView.getContentHeight()\r\n      if (height > this.listView.node.getComponent(UITransform).height) {\r\n        this.listView.getComponent(ScrollView).elastic = true\r\n      }\r\n      else {\r\n        this.listView.getComponent(ScrollView).elastic = false\r\n      }\r\n    }, 0.1)\r\n  }\r\n\r\n  initData() {\r\n    this._roomKey = JmRoomDataMgr.GetCurrentRoomKey();\r\n    // this.gameRoomSeatsInfoData = JmRoomDataMgr.GetRoomSeats();\r\n  }\r\n\r\n  updateUI() {\r\n    // this.log('JmRoomDataMgr.isOwner()=', JmRoomDataMgr.isOwner())\r\n    let isOwner = JmRoomDataMgr.isOwner()\r\n    // this.otherNode.active = !isOwner\r\n    this.updateBtn()\r\n    let gameState = this.gameState = 1//JmRoomDataMgr.getGameState()\r\n    if (isOwner) {\r\n      this.identityTxt.string = '法官'\r\n      // JmResourceMgr.LoadBundleSpriteRes('identityBig/card_judge', this.identityIcon);\r\n      let self = this\r\n      app.manager.loader.load({\r\n        bundle: 'identitybig', // 不传入bundle，默认为resources\r\n        path: 'card_judge/spriteFrame',\r\n        type: SpriteFrame,\r\n        onComplete(asset) {\r\n          console.log('加载资源完成', asset);\r\n          self.identityIcon.getComponent(Sprite).spriteFrame = asset;\r\n        }\r\n      })\r\n    }\r\n    else {\r\n      if (gameState == 1 || gameState == 2) {\r\n        this.identityTxt.string = '等待发牌'\r\n        // JmResourceMgr.LoadBundleSpriteRes('identity/card_myrole__', this.identityIcon);\r\n      } else if (gameState == 0) {\r\n        // this.gameRoomSeatsInfoData.forEach(data => {\r\n        //   if (data.userId == JmUserDataMgr.GetCurrentUserId()) {\r\n        //     if (data.identity == 0)\r\n        //       this.identityTxt.string = '等待发牌'\r\n        //     else\r\n        //       EventManager.Send(JmDataEvent.UPDATE_GAME_IDENTITY, data.identity);\r\n        //   }\r\n        // });\r\n      }\r\n    }\r\n    this.updateDay(gameState == 2)\r\n  }\r\n\r\n  updateDay(isDay: boolean) {\r\n    let url = ''\r\n    // JmRoomDataMgr.setGameDay(isDay)\r\n    if (isDay) {\r\n      url = 'room/bg_day'\r\n      if (app.Manager.Util.IsIphoneX()) {\r\n        url = 'room/bg_day_x'\r\n      }\r\n      else if (app.Manager.Util.IsIpad()) {\r\n        url = 'room/bg_day_iPad'\r\n      }\r\n      // JmResourceMgr.LoadBundleSpriteRes('room/bg_myrole_day', this.layoutBg);\r\n      // JmResourceMgr.LoadBundleSpriteRes('room/bg_myrole1_day', this.identityBg);\r\n      this.identityLabel.color = new Color().fromHEX(\"#6E7C99\");\r\n      this.cfgText.string = `<color=#848EA3>【本局配置】</c><color=#4A5979>${this.txt}</color>`\r\n\r\n      this.identityNode.getComponent(Widget).bottom = 170\r\n    } else {\r\n      url = 'room/bg_night'\r\n      if (app.Manager.Util.IsIphoneX()) {\r\n        url = 'room/bg_night_x'\r\n      }\r\n      else if (app.Manager.Util.IsIpad()) {\r\n        url = 'room/bg_night_iPad'\r\n      }\r\n      // JmResourceMgr.LoadBundleSpriteRes('room/bg_myrole_night', this.layoutBg);\r\n      // JmResourceMgr.LoadBundleSpriteRes('room/bg_myrole1_night', this.identityBg);\r\n      this.identityLabel.color = new Color().fromHEX(\"#8474A4\");\r\n      this.cfgText.string = `<color=#8474A4>【本局配置】</c><color=#2A1658>${this.txt}</color>`\r\n      if (!JmRoomDataMgr.isOwner()) {\r\n        this.identityNode.getComponent(Widget).bottom = 0\r\n      }\r\n    }\r\n    if (!JmRoomDataMgr.isOwner()) {//|| this.advertisementNode.active) {\r\n      this.identityNode.getComponent(Widget).updateAlignment();\r\n      this.listView.node.getComponent(Widget).updateAlignment();\r\n      this.listView.node.getChildByName('view').getComponent(Widget).updateAlignment();\r\n      this.listView.node.getChildByName('view').getChildByName('content').getComponent(Widget).updateAlignment();\r\n    }\r\n    // JmResourceMgr.LoadBundleSpriteRes(url, this.bg);\r\n    let data = [\r\n      { \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 },\r\n      { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }]\r\n\r\n\r\n    // let data = JmRoomDataMgr.GetRoomSeats()\r\n    if (data) {\r\n      this.listView.setData(this.sliceData(data));\r\n      this.scheduleOnce(() => {\r\n        this.listView.notifyChange()\r\n      }, 0.1)\r\n    }\r\n  }\r\n\r\n\r\n  private restoreData(slicedData: Array<Array<any>>): Array<any> {\r\n    let result: any = [];\r\n    for (let i = 0, len = slicedData.length; i < len; i++) {\r\n      result = result.concat(slicedData[i]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private sliceData(data: Array<any>) {\r\n    let result = []\r\n    for (let i = 0, len = data.length; i < len; i += 4) {\r\n      result.push(data.slice(i, i + 4));\r\n    }\r\n    return result\r\n  }\r\n\r\n\r\n  type = 1\r\n  testType = 1\r\n  onClickStart() {\r\n    // // JmRoomDataMgr.setGameState(true)\r\n    // this.updateBtn()\r\n    // if (this.type > 16)\r\n    //   this.type = 1;\r\n    // // EventManager.Send(JmDataEvent.UPDATE_GAME_IDENTITY, this.type++);\r\n\r\n    app.controller.room.updateGameIdentity(this.testType++);\r\n    let data = this.restoreData(this.listView.getData())\r\n    for (let i = 0; i < data.length - 3; i++) {\r\n      data[i].identity = this.testType++;\r\n      if (this.testType > 16)\r\n        this.testType = 1\r\n    }\r\n    this.listView.setData(this.sliceData(data));\r\n  }\r\n\r\n\r\n  updateIdentity(type: number) {\r\n    // if (JmRoomDataMgr.isOwner()) return\r\n    let self = this\r\n    this.log('type=', type);\r\n    this.identityType = type\r\n    this.identityTxt.string = this.allotIdentityCfg[type].name\r\n    // JmResourceMgr.LoadBundleSpriteRes(AllotIdentityCfg[type].icon, this.identityIcon);\r\n    // JmResourceMgr.LoadBundlePrefab('prefab/JmIdentityCard', function (err, prefab) {\r\n    //   if (err) {\r\n    //     Log.Log(err.message || err);\r\n    //     return;\r\n    //   }\r\n    //   let cardNode = self.cardNode;\r\n    //   if (cardNode && cc.isValid(cardNode)) {\r\n    //     cardNode.active = false;\r\n    //     cardNode.removeFromParent();\r\n    //     cardNode.destroy();\r\n    //   }\r\n    //   self.cardNode = null;\r\n    //   Log.Log(\"LoadPerfab>>>success\")\r\n    //   let node = cc.instantiate(prefab);\r\n    //   self.cardNode = node\r\n    //   node.active = true;\r\n    //   node.getComponent(\"JmIdentityCard\").init(type);\r\n    //   self.node.addChild(self.cardNode);\r\n    // })\r\n  }\r\n\r\n  updateBtn() {\r\n    // // this.log(`JmRoomDataMgr.getGameState()= ${JmRoomDataMgr.getGameState()}`);\r\n    // let isGameing = JmRoomDataMgr.getGameState() == 0 || JmRoomDataMgr.getGameState() == 1\r\n    // this.godNode.active = !isGameing && JmRoomDataMgr.isOwner()\r\n    // this.btnAgain.active = isGameing && JmRoomDataMgr.isOwner()\r\n    // if (JmRoomDataMgr.getGameState() == this.gameState) {\r\n    //     this.btnAgain.getComponent(Button).interactable = true\r\n    // }\r\n    // else {\r\n    //     if (!this.btnAgain.getComponent(Button).interactable) {\r\n    //         this.scheduleOnce(() => {\r\n    //             this.btnAgain.getComponent(Button).interactable = true\r\n    //         }, 3)\r\n    //     }\r\n    // }\r\n  }\r\n\r\n\r\n  onClickTestRes() {\r\n    // let rsp1 =\r\n    //   { \"recordId\": 49, \"roomNum\": 1036, \"status\": 0, \"players\": 24, \"curPlayers\": 2, \"judge\": true, \r\n    //     \"seats\": [\r\n    //       { \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 }, \r\n    //       { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }], \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\" }\r\n    // let rsp2 =\r\n    //   { \"recordId\": 49, \"roomNum\": 1036, \"status\": 0, \"players\": 24, \"curPlayers\": 2, \"judge\": false, \"seats\": [{ \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 }, { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }], \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\" }\r\n\r\n    // let rsp = JmRoomDataMgr.isOwner() ? rsp1 : rsp2\r\n    // JmRoomDataMgr.InitCurrentRoom(rsp);\r\n    // EventManager.SendImmediately(JmDataEvent.UDPATE_ROOM_SEATS, rsp);\r\n    // this.updateRoomSeats(rsp.seats);\r\n  }\r\n  onClickTestRes1() {\r\n    // let rsp1 =\r\n    //   { \"recordId\": 49, \"roomNum\": 1036, \"status\": 2, \"players\": 24, \"curPlayers\": 2, \"judge\": true, \"seats\": [{ \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 }, { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }], \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\" }\r\n    // let rsp2 =\r\n    //   { \"recordId\": 49, \"roomNum\": 1036, \"status\": 2, \"players\": 24, \"curPlayers\": 2, \"judge\": false, \"seats\": [{ \"userId\": 100022, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/0BBA8D3211B54E6C6BC9B15C8E7CF8F3/100\", \"nickName\": \"易乐乐\", \"status\": 1, \"identity\": 15 }, { \"userId\": 100023, \"headerThumb\": \"https://thirdqq.qlogo.cn/qqapp/1110879879/7C90B13F53B0B0A84346A317724EF6EF/100\", \"nickName\": \"DH\", \"status\": 1, \"identity\": 15 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }, { \"status\": 0, \"identity\": 0 }], \"identities\": \"{\\\"11\\\":1,\\\"12\\\":1,\\\"1\\\":1,\\\"13\\\":1,\\\"2\\\":1,\\\"14\\\":1,\\\"3\\\":4,\\\"15\\\":12,\\\"9\\\":1,\\\"10\\\":1}\" }\r\n\r\n    // let rsp = JmRoomDataMgr.isOwner() ? rsp1 : rsp2\r\n    // JmRoomDataMgr.InitCurrentRoom(rsp);\r\n    // // EventManager.SendImmediately(JmDataEvent.UDPATE_ROOM_SEATS, rsp);\r\n    // let self = this;\r\n    //   let headerThumb ='https://thirdqq.qlogo.cn/qqapp/1110879879/1F341E6B680513E1095DBDF19AF223D8/100' \r\n    //   app.manager.loader.loadRemote({\r\n    //       url: headerThumb,\r\n    //       onComplete(data: any) {\r\n    //           let sp: SpriteFrame = new SpriteFrame();\r\n    //           let texture = new Texture2D();\r\n    //           texture = data;\r\n    //           sp.texture = texture;\r\n    //           sp.packable = false;\r\n    //         // if (self.icon) {\r\n    //         //   self.icon.getComponent(Sprite).spriteFrame = sp;\r\n    //         // }\r\n\r\n    //           self.identityIcon.getComponent(Sprite).spriteFrame = sp;\r\n    //       }\r\n    //   })=\r\n  }\r\n\r\n  updateRoomSeats(data: any) {\r\n    this.gameRoomSeatsInfoData = JmRoomDataMgr.GetRoomSeats();\r\n    if (this.gameState != JmRoomDataMgr.getGameState()) {\r\n      this.gameState = JmRoomDataMgr.getGameState()\r\n      this.updateUI()\r\n    }\r\n    else {\r\n      let day = this.gameState == 0 ? false : true\r\n      this.updateDay(day)\r\n    }\r\n  }\r\n}"]}